(window.webpackJsonp=window.webpackJsonp||[]).push([[20,8,16],{600:function(e,t,n){"use strict";n.r(t);var r=n(241),o=n(31),component=Object(o.a)({},(function(){var e=this._self._c;return e("div",{staticClass:"text-center"},[e(r.a,{attrs:{indeterminate:""}})],1)}),[],!1,null,null,null);t.default=component.exports},602:function(e,t,n){"use strict";n.r(t);var r=n(591),o={props:{color:{type:String,default:null},message:{type:String,default:null}}},c=n(31),component=Object(c.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-center",on:{click:function(t){return e.$emit("click")}}},[t(r.a,{attrs:{color:e.color}},[e._v(e._s(e.message))])],1)}),[],!1,null,null,null);t.default=component.exports},671:function(e,t,n){"use strict";n.r(t);var r=n(240),o=n(572),c=n(676),l=n(597),d=n(596),m=n(589),f=n(242),v=n(156),h=n(243),_=n(95),y=n(590),O=(n(8),n(7),n(10),n(4),n(13),n(11),n(14),n(1));function w(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function j(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?w(Object(source),!0).forEach((function(t){Object(O.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):w(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var k=n(22),D=(n(63),n(76),n(85),n(107));function P(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function x(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?P(Object(source),!0).forEach((function(t){Object(O.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):P(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var C={components:{ValidationObserver:D.a,ValidationProvider:D.b},data:function(){return{loading:!1,demands:[],previewDemand:null,form:{title:this.$moment().locale("pt-br").format("MMM-YYYY").toUpperCase(),status:"pending",points:0,price:0,estimate_in_days:0,items:[]}}},computed:{totalPrice:function(){return this.selectedItems.reduce((function(e,t){return e+t.price}),0)},totalPoints:function(){return this.selectedItems.reduce((function(e,t){return e+t.points}),0)},totalEstimateInDays:function(){return this.selectedItems.reduce((function(e,t){return e+t.estimate_in_days}),0)},selectedItems:function(){return this.form.items.filter((function(e){return e.checked})).map((function(e){return{demand:e.demand._id,points:e.points,price:e.price,estimate_in_days:e.estimate_in_days}}))},allChecked:function(){return this.form.items.every((function(e){return e.checked}))}},created:function(){this.loadDemands()},methods:{loadDemands:function(){var e=this;return Object(k.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.$axios.$get("/v1/demands",{params:{status:"backlog",customer:e.customer._id,approved:!1,billable:!0,with_points:!0}});case 3:e.demands=t.sent,e.demands.forEach((function(t){e.form.items.push({demand:t,price:t.price,points:t.points,estimate_in_days:t.estimate_in_days,checked:!1})})),1===e.demands.length&&(e.form.items[0].checked=!0),e.loading=!1;case 7:case"end":return t.stop()}}),t)})))()},save:function(){var e=this,form=x({},this.form);form.items=this.selectedItems,form.price=this.totalPrice,form.points=this.totalPoints,form.estimate_in_days=this.totalEstimateInDays,this.loading=!0,this.$axios.$post("/v1/proposals",x(x({},form),{},{customer:this.customer._id})).then((function(t){e.$notifier.success("Proposta gerada!"),e.$emit("input",t)})),this.loading=!1},demandUpdated:function(e){var t=this.form.items.find((function(t){return t.demand._id===e._id}));t.demand=e,t.price=e.price,t.points=e.points,t.estimate_in_days=e.estimate_in_days,this.previewDemand=e},toggleSelection:function(){var e=!0;this.allChecked&&(e=!1),this.form.items.forEach((function(t){t.checked=e}))},close:function(){this.$emit("close")}}},S=n(31),component=Object(S.a)(C,(function(){var e=this,t=e._self._c;return t(d.a,{attrs:{value:!0,fullscreen:"",persistent:""}},[t(o.a,[t("DialogHeader",{on:{close:e.close}}),e._v(" "),e.loading?t("div",{staticClass:"pt-6"},[t("Loading")],1):t("div",[t(l.a,[t("h3",{staticClass:"font-weight-medium"},[e._v("Gerar proposta de orçamento")])]),e._v(" "),t("ValidationObserver",{scopedSlots:e._u([{key:"default",fn:function(n){var o=n.validate,d=n.invalid;return[t(m.a,{on:{submit:function(t){t.preventDefault(),o().then(e.save)}}},[t("div",[t(l.a,[t("validation-provider",{attrs:{name:"Título da proposta",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(n){var r=n.errors;return[t(y.a,{attrs:{rows:"1","auto-grow":"",label:"Título da proposta",outlined:"","error-messages":r,focusable:""},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})]}}],null,!0)}),e._v(" "),e.form.items&&e.form.items.length?t("div",[t("div",{staticClass:"text-subtitle-2 text--secondary mb-3"},[e._v("\n                  Selecione as demandas que deseja incluir na proposta:\n                ")]),e._v(" "),e.form.items.length>1?t("div",{staticClass:"text-right"},[t(r.a,{attrs:{color:"success","x-small":""},on:{click:e.toggleSelection}},[e._v("Selecionar "+e._s(e.allChecked?"nenhuma":"todas"))])],1):e._e(),e._v(" "),t(f.a,{staticClass:"mx-n4 mb-3"},e._l(e.form.items,(function(n){return t(v.a,{key:n._id,staticClass:"secondary"},[t(_.a,[t("a",{staticClass:"d-block",on:{click:function(t){e.previewDemand=n.demand}}},[t("span",{staticClass:"text-subtitle-2"},[e._v(e._s(n.demand.title))]),e._v(" "),t("EstimateValues",{attrs:{item:j(j({},n),{},{billable:!0})}})],1),e._v(" "),n.points>0?t(_.b):e._e()],1),e._v(" "),t(h.a,[t(c.a,{attrs:{color:"success",large:""},model:{value:n.checked,callback:function(t){e.$set(n,"checked",t)},expression:"item.checked"}})],1)],1)})),1),e._v(" "),e.totalPoints>0?t("div",{staticClass:"text-right"},[t("h3",[e._v("\n                    Total: "+e._s(e._f("moeda")(e.totalPrice))+" -\n                    "+e._s(e.$utils.plural(e.totalEstimateInDays,"dia útil"))+"\n                  ")]),e._v(" "),t("Save",{attrs:{invalid:d,block:!1,label:"Salvar"}})],1):e._e()],1):t("div",[t("Alert",{attrs:{message:"Nenhuma com valor estimado foi encontrada na fila para a proposta"}})],1)],1)],1)])]}}])})],1),e._v(" "),e.previewDemand?t("Demand",{attrs:{demand:e.previewDemand,preview:""},on:{close:function(t){e.previewDemand=null},input:e.demandUpdated}}):e._e()],1)],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{DialogHeader:n(358).default,Loading:n(600).default,EstimateValues:n(609).default,Save:n(359).default,Alert:n(602).default,Demand:n(610).default})}}]);