(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{671:function(t,e,r){"use strict";r.r(e);var o=r(240),n=r(572),l=r(676),c=r(597),d=r(596),m=r(589),f=r(242),v=r(156),_=r(243),h=r(95),y=r(590),O=(r(8),r(7),r(10),r(4),r(13),r(11),r(14),r(1));function P(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function j(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?P(Object(source),!0).forEach((function(e){Object(O.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):P(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var w=r(22),k=(r(63),r(76),r(85),r(107));function D(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function C(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?D(Object(source),!0).forEach((function(e){Object(O.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):D(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var x={components:{ValidationObserver:k.a,ValidationProvider:k.b},data:function(){return{loading:!1,demands:[],previewDemand:null,form:{title:this.$moment().locale("pt-br").format("MMM-YYYY").toUpperCase(),status:"pending",points:0,price:0,estimate_in_days:0,items:[]}}},computed:{totalPrice:function(){return this.selectedItems.reduce((function(t,e){return t+e.price}),0)},totalPoints:function(){return this.selectedItems.reduce((function(t,e){return t+e.points}),0)},totalEstimateInDays:function(){return this.selectedItems.reduce((function(t,e){return t+e.estimate_in_days}),0)},selectedItems:function(){return this.form.items.filter((function(t){return t.checked})).map((function(t){return{demand:t.demand._id,points:t.points,price:t.price,estimate_in_days:t.estimate_in_days}}))},allChecked:function(){return this.form.items.every((function(t){return t.checked}))}},created:function(){this.loadDemands()},methods:{loadDemands:function(){var t=this;return Object(w.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.$axios.$get("/v1/demands",{params:{status:"backlog",customer:t.customer._id,approved:!1,billable:!0,with_points:!0}});case 3:t.demands=e.sent,t.demands.forEach((function(e){t.form.items.push({demand:e,price:e.price,points:e.points,estimate_in_days:e.estimate_in_days,checked:!1})})),1===t.demands.length&&(t.form.items[0].checked=!0),t.loading=!1;case 7:case"end":return e.stop()}}),e)})))()},save:function(){var t=this,form=C({},this.form);form.items=this.selectedItems,form.price=this.totalPrice,form.points=this.totalPoints,form.estimate_in_days=this.totalEstimateInDays,this.loading=!0,this.$axios.$post("/v1/proposals",C(C({},form),{},{customer:this.customer._id})).then((function(e){t.$notifier.success("Proposta gerada!"),t.$emit("input",e)})),this.loading=!1},demandUpdated:function(t){var e=this.form.items.find((function(e){return e.demand._id===t._id}));e.demand=t,e.price=t.price,e.points=t.points,e.estimate_in_days=t.estimate_in_days,this.previewDemand=t},toggleSelection:function(){var t=!0;this.allChecked&&(t=!1),this.form.items.forEach((function(e){e.checked=t}))},close:function(){this.$emit("close")}}},$=r(31),component=Object($.a)(x,(function(){var t=this,e=t._self._c;return e(d.a,{attrs:{value:!0,fullscreen:"",persistent:""}},[e(n.a,[e("DialogHeader",{on:{close:t.close}}),t._v(" "),t.loading?e("div",{staticClass:"pt-6"},[e("Loading")],1):e("div",[e(c.a,[e("h3",{staticClass:"font-weight-medium"},[t._v("Gerar proposta de orçamento")])]),t._v(" "),e("ValidationObserver",{scopedSlots:t._u([{key:"default",fn:function(r){var n=r.validate,d=r.invalid;return[e(m.a,{on:{submit:function(e){e.preventDefault(),n().then(t.save)}}},[e("div",[e(c.a,[e("validation-provider",{attrs:{name:"Título da proposta",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(r){var o=r.errors;return[e(y.a,{attrs:{rows:"1","auto-grow":"",label:"Título da proposta",outlined:"","error-messages":o,focusable:""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})]}}],null,!0)}),t._v(" "),t.form.items&&t.form.items.length?e("div",[e("div",{staticClass:"text-subtitle-2 text--secondary mb-3"},[t._v("\n                  Selecione as demandas que deseja incluir na proposta:\n                ")]),t._v(" "),t.form.items.length>1?e("div",{staticClass:"text-right"},[e(o.a,{attrs:{color:"success","x-small":""},on:{click:t.toggleSelection}},[t._v("Selecionar "+t._s(t.allChecked?"nenhuma":"todas"))])],1):t._e(),t._v(" "),e(f.a,{staticClass:"mx-n4 mb-3"},t._l(t.form.items,(function(r){return e(v.a,{key:r._id,staticClass:"secondary"},[e(h.a,[e("a",{staticClass:"d-block",on:{click:function(e){t.previewDemand=r.demand}}},[e("span",{staticClass:"text-subtitle-2"},[t._v(t._s(r.demand.title))]),t._v(" "),e("EstimateValues",{attrs:{item:j(j({},r),{},{billable:!0})}})],1),t._v(" "),r.points>0?e(h.b):t._e()],1),t._v(" "),e(_.a,[e(l.a,{attrs:{color:"success",large:""},model:{value:r.checked,callback:function(e){t.$set(r,"checked",e)},expression:"item.checked"}})],1)],1)})),1),t._v(" "),t.totalPoints>0?e("div",{staticClass:"text-right"},[e("h3",[t._v("\n                    Total: "+t._s(t._f("moeda")(t.totalPrice))+" -\n                    "+t._s(t.$utils.plural(t.totalEstimateInDays,"dia útil"))+"\n                  ")]),t._v(" "),e("Save",{attrs:{invalid:d,block:!1,label:"Salvar"}})],1):t._e()],1):e("div",[e("Alert",{attrs:{message:"Nenhuma com valor estimado foi encontrada na fila para a proposta"}})],1)],1)],1)])]}}])})],1),t._v(" "),t.previewDemand?e("Demand",{attrs:{demand:t.previewDemand,preview:""},on:{close:function(e){t.previewDemand=null},input:t.demandUpdated}}):t._e()],1)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{DialogHeader:r(358).default,Loading:r(600).default,EstimateValues:r(609).default,Save:r(359).default,Alert:r(602).default,Demand:r(610).default})},698:function(t,e,r){"use strict";r.r(e);var o=r(240),n=r(572),l=r(611),c=r(597),d=r(155),m=(r(8),r(7),r(10),r(4),r(13),r(11),r(14),r(1));function f(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function v(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(e){Object(m.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var _=r(22),h=(r(63),r(85),r(215),r(166),{layout:"customer",data:function(){return{proposals:null,addProposal:!1}},computed:{activeProposal:function(){var t=this;return this.$route.query.proposta&&this.proposals?this.proposals.find((function(e){return e._id===t.$route.query.proposta})):null}},watch:{customer:function(){this.loadProposals()}},created:function(){var t=this;return Object(_.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.customer){e.next=3;break}return e.next=3,t.loadProposals();case 3:case"end":return e.stop()}}),e)})))()},methods:{loadProposals:function(){var t=this;return Object(_.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.proposals=null,e.next=3,t.$axios.$get("/v1/proposals",{params:{customer:t.customer._id}});case 3:t.proposals=e.sent;case 4:case"end":return e.stop()}}),e)})))()},estimateInDays:function(t){return Math.ceil(t/this.customer.points_per_day)},proposalCreated:function(){this.addProposal=!1,this.loadProposals(),this.loadSummary()},proposalUpdated:function(t){var e=this.proposals.findIndex((function(e){return e._id===t._id}));this.proposals.splice(e,1,t),this.loadSummary()},closeProposal:function(){this.$router.push("/"+this.customer._id+"/propostas")},loadSummary:function(){this.$store.dispatch("loadCustomerSummary")}}}),y=r(31),component=Object(y.a)(h,(function(){var t=this,e=t._self._c;return e("div",["provider"===t.$auth.user.role?e(o.a,{attrs:{fab:"",fixed:"",bottom:"",right:"",color:"success"},on:{click:function(e){t.addProposal=!0}}},[e(d.a,[t._v("mdi-plus")])],1):t._e(),t._v(" "),e(c.a,[e("div",[t.proposals?e("div",[t.proposals.length?t._e():e("div",[e("Alert",{attrs:{message:"Nenhuma proposta aqui"}})],1),t._v(" "),t.proposals&&t.proposals.length?e("div",t._l(t.proposals,(function(r){return e(n.a,{key:r._id,staticClass:"mb-3 pa-3",attrs:{elevation:"0",to:"/"+t.customer._id+"/propostas?proposta="+r._id}},[e("div",[e("h4",{staticClass:"mb-1"},[t._v(t._s(r.title))]),t._v(" "),r.points>0?e("div",[e("div",{staticClass:"mb-1"},[r.startAt&&r.deadline?e("div",{staticClass:"caption"},[t._v("\n                    "+t._s(t.$moment(r.startAt).format("DD/MM/YYYY"))+" -\n                    "+t._s(t.$moment(r.deadline).format("DD/MM/YYYY"))+"\n                  ")]):e("div",[e("small",[t._v("\n                      "+t._s(t.$moment(r.createdAt).format("DD/MM/YYYY"))+"\n                    ")])])]),t._v(" "),e("div",[e("EstimateValues",{attrs:{item:v(v({},r),{},{billable:!0})}})],1)]):t._e(),t._v(" "),e("div",{staticClass:"pt-3"},[e("div",["approved"===r.status?e(l.a,{attrs:{outlined:"",small:"",color:"success"}},[e(d.a,{attrs:{left:"",small:""}},[t._v(" mdi-check ")]),t._v("\n                    Aprovada\n                  ")],1):t._e(),t._v(" "),"rejected"===r.status?e(l.a,{attrs:{outlined:"",small:"",color:"error"}},[e(d.a,{attrs:{left:"",small:""}},[t._v(" mdi-close-thick ")]),t._v("\n                    Rejeitada\n                  ")],1):t._e(),t._v(" "),"canceled"===r.status?e(l.a,{attrs:{outlined:"",small:"",color:"error"}},[e(d.a,{attrs:{left:"",small:""}},[t._v(" mdi-cancel ")]),t._v("\n                    Cancelada\n                  ")],1):t._e(),t._v(" "),"pending"===r.status?e(l.a,{attrs:{small:"",outlined:""}},[e(d.a,{attrs:{left:"",small:""}},[t._v(" mdi-clock ")]),t._v("\n                    Aguardando aprovação\n                  ")],1):t._e()],1),t._v(" "),e("div")])])])})),1):t._e()]):e("Loading")],1)]),t._v(" "),t.addProposal?e("ProposalForm",{on:{input:t.proposalCreated,close:function(e){t.addProposal=!1}}}):t._e(),t._v(" "),t.activeProposal?e("Proposal",{attrs:{"proposal-id":t.activeProposal._id},on:{input:t.proposalUpdated,close:t.closeProposal}}):t._e()],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{Alert:r(602).default,EstimateValues:r(609).default,Loading:r(600).default,ProposalForm:r(671).default,Proposal:r(689).default})}}]);