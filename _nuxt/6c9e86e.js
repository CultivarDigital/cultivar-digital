(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{670:function(e,t,r){"use strict";r.r(t);var n=r(240),c=r(572),o=r(676),l=r(597),d=r(596),v=r(589),m=r(242),f=r(156),_=r(243),h=r(95),S=r(590),y=(r(26),r(8),r(7),r(13),r(14),r(1)),w=r(22),k=(r(63),r(10),r(4),r(76),r(11),r(85),r(107));function O(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function I(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?O(Object(source),!0).forEach((function(t){Object(y.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):O(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var C={components:{ValidationObserver:k.a,ValidationProvider:k.b},data:function(){return{loading:!1,demands:[],previewDemand:null,previewRecurringService:null,form:{title:this.$moment().locale("pt-br").format("MMM-YYYY").toUpperCase(),status:"pending",price:0,items:[]}}},computed:{demandItems:function(){return this.form.items.filter((function(e){return e.demand}))},recurringServiceItems:function(){return this.form.items.filter((function(e){return e.recurringService}))},totalPrice:function(){return this.selectedItems.reduce((function(e,t){return e+t.price}),0)},selectedItems:function(){return this.form.items.filter((function(e){return e.checked})).map((function(e){return{demand:e.demand?e.demand._id:null,recurringService:e.recurringService?e.recurringService._id:null,price:e.price}}))}},created:function(){this.loadItems()},methods:{loadItems:function(){var e=this;return Object(w.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.$axios.$get("/v1/demands",{params:{status:"done",customer:e.customer._id,billable:!0,with_points:!0,paid:!1}});case 3:return e.demands=t.sent,e.demands.forEach((function(t){e.form.items.push({demand:t,price:t.price,checked:!1})})),t.next=7,e.$axios.$get("/v1/recurring-services",{params:{customer:e.customer._id}});case 7:e.recurringServices=t.sent,e.recurringServices.forEach((function(t){e.form.items.push({recurringService:t,price:t.price,checked:!1})})),1===e.form.items.length&&(e.form.items[0].checked=!0),e.loading=!1;case 11:case"end":return t.stop()}}),t)})))()},save:function(){var e=this,form=I({},this.form);form.items=this.selectedItems,form.price=this.totalPrice,this.loading=!0,this.$axios.$post("/v1/invoices",I(I({},form),{},{customer:this.customer._id})).then((function(t){e.$notifier.success("Fatura gerada!"),e.$emit("input",t)})),this.loading=!1},demandUpdated:function(e){var t=this.form.items.find((function(t){return t.demand._id===e._id}));t.demand=e,t.price=e.price,this.previewDemand=e},recurringServiceUpdated:function(e){var t=this.form.items.find((function(t){return t.recurringService._id===e._id}));t.recurringService=e,t.price=e.price,this.previewRecurringService=e},allChecked:function(e){return this.form.items.filter((function(i){return i[e]})).every((function(e){return e.checked}))},toggleSelection:function(e){var t=!0;this.allChecked(e)&&(t=!1),this.form.items.filter((function(i){return i[e]})).forEach((function(e){e.checked=t}))},close:function(){this.$emit("close")}}},j=r(31),component=Object(j.a)(C,(function(){var e=this,t=e._self._c;return t(d.a,{attrs:{value:!0,fullscreen:"",persistent:""}},[t(c.a,[t("DialogHeader",{on:{close:e.close}}),e._v(" "),e.loading?t("div",{staticClass:"pt-6"},[t("Loading")],1):t("div",[t(l.a,[t("h3",{staticClass:"font-weight-medium"},[e._v("Gerar fatura")])]),e._v(" "),t("ValidationObserver",{scopedSlots:e._u([{key:"default",fn:function(r){var c=r.validate,d=r.invalid;return[t(v.a,{on:{submit:function(t){t.preventDefault(),c().then(e.save)}}},[t("div",[t(l.a,[t("validation-provider",{attrs:{name:"Título da fatura",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(r){var n=r.errors;return[t(S.a,{attrs:{rows:"1","auto-grow":"",label:"Título da fatura",outlined:"","error-messages":n,focusable:""},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})]}}],null,!0)}),e._v(" "),e.demandItems.length?t("div",[t("div",{staticClass:"text-subtitle-2 text--secondary mb-6"},[e._v("\n                  Selecione os items que deseja incluir na fatura:\n                ")]),e._v(" "),e.demandItems.length>1?t("div",{staticClass:"d-flex justify-space-between"},[t("div",[t("strong",[e._v("Demandas")])]),e._v(" "),t(n.a,{attrs:{color:"success","x-small":""},on:{click:function(t){return e.toggleSelection("demand")}}},[e._v("Selecionar\n                    "+e._s(e.allChecked("demand")?"nenhuma":"todas"))])],1):e._e(),e._v(" "),t(m.a,{staticClass:"mx-n4 mb-3"},e._l(e.demandItems,(function(r){return t(f.a,{key:r._id,staticClass:"secondary"},[t(h.a,[t("a",{staticClass:"d-block",on:{click:function(t){e.previewDemand=r.demand}}},[t("span",{staticClass:"text-subtitle-2"},[e._v(e._s(r.demand.title))]),e._v(" "),t("div",{staticClass:"caption text--secondary"},[e._v("\n                          "+e._s(e._f("moeda")(r.price))+"\n                        ")])])]),e._v(" "),t(_.a,[t(o.a,{attrs:{color:"success",large:""},model:{value:r.checked,callback:function(t){e.$set(r,"checked",t)},expression:"item.checked"}})],1)],1)})),1)],1):e._e(),e._v(" "),e.recurringServiceItems.length?t("div",[e.recurringServiceItems.length>1?t("div",{staticClass:"d-flex justify-space-between"},[t("div",[t("strong",[e._v("Serviços recorrentes")])]),e._v(" "),t(n.a,{attrs:{color:"success","x-small":""},on:{click:function(t){return e.toggleSelection("recurringService")}}},[e._v("Selecionar\n                    "+e._s(e.allChecked("recurringService")?"nenhum":"todos"))])],1):e._e(),e._v(" "),t(m.a,{staticClass:"mx-n4 mb-3"},e._l(e.recurringServiceItems,(function(r){return t(f.a,{key:r._id,staticClass:"secondary"},[t(h.a,[t("a",{staticClass:"d-block",on:{click:function(t){e.previewRecurringService=r.recurringService}}},[t("span",{staticClass:"text-subtitle-2"},[e._v(e._s(r.recurringService.name))]),e._v(" "),t("div",{staticClass:"caption text--secondary"},[e._v("\n                          "+e._s(e._f("moeda")(r.price))+"\n                        ")])])]),e._v(" "),t(_.a,[t(o.a,{attrs:{color:"success",large:""},model:{value:r.checked,callback:function(t){e.$set(r,"checked",t)},expression:"item.checked"}})],1)],1)})),1)],1):e._e(),e._v(" "),e.recurringServiceItems.length||e.demandItems.length?e._e():t("div",[t("Alert",{attrs:{message:"Nenhuma demanda ou serviço recorrente foi encontrado para a fatura"}})],1),e._v(" "),e.totalPrice>0?t("div",{staticClass:"text-right"},[t("h3",[e._v("Total: "+e._s(e._f("moeda")(e.totalPrice)))]),e._v(" "),t("Save",{attrs:{invalid:d,block:!1,label:"Salvar"}})],1):e._e()],1)],1)])]}}])})],1),e._v(" "),e.previewDemand?t("Demand",{attrs:{demand:e.previewDemand,preview:""},on:{close:function(t){e.previewDemand=null},input:e.demandUpdated}}):e._e(),e._v(" "),e.previewRecurringService?t("RecurringService",{attrs:{demand:e.previewRecurringService,preview:""},on:{close:function(t){e.previewRecurringService=null},input:e.recurringServiceUpdated}}):e._e()],1)],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{DialogHeader:r(358).default,Loading:r(601).default,Alert:r(602).default,Save:r(359).default,Demand:r(610).default,RecurringService:r(641).default})},696:function(e,t,r){"use strict";r.r(t);var n=r(240),c=r(572),o=r(611),l=r(597),d=r(155),v=(r(8),r(7),r(10),r(4),r(13),r(11),r(14),r(1));function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(v.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var _=r(22),h=(r(63),r(85),r(215),r(166),{layout:"customer",data:function(){return{invoices:null,addInvoice:!1}},computed:{activeInvoice:function(){var e=this;return this.$route.query.fatura&&this.invoices?this.invoices.find((function(t){return t._id===e.$route.query.fatura})):null}},watch:{customer:function(){this.loadInvoices()}},created:function(){var e=this;return Object(_.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.customer){t.next=3;break}return t.next=3,e.loadInvoices();case 3:case"end":return t.stop()}}),t)})))()},methods:{loadInvoices:function(){var e=this;return Object(_.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.invoices=null,t.next=3,e.$axios.$get("/v1/invoices",{params:{customer:e.customer._id}});case 3:e.invoices=t.sent;case 4:case"end":return t.stop()}}),t)})))()},estimateInDays:function(e){return Math.ceil(e/this.customer.points_per_day)},invoiceCreated:function(){this.addInvoice=!1,this.loadInvoices(),this.loadSummary()},invoiceUpdated:function(e){var t=this.invoices.findIndex((function(t){return t._id===e._id}));this.invoices.splice(t,1,e),this.loadSummary()},closeInvoice:function(){this.$router.push("/"+this.customer._id+"/faturas")},loadSummary:function(){this.$store.dispatch("loadCustomerSummary")}}}),S=r(31),component=Object(S.a)(h,(function(){var e=this,t=e._self._c;return t("div",["provider"===e.$auth.user.role?t(n.a,{attrs:{fab:"",fixed:"",bottom:"",right:"",color:"success"},on:{click:function(t){e.addInvoice=!0}}},[t(d.a,[e._v("mdi-plus")])],1):e._e(),e._v(" "),t(l.a,[t("div",[e.invoices?t("div",[e.invoices.length?e._e():t("div",[t("Alert",{attrs:{message:"Nenhuma fatura aqui"}})],1),e._v(" "),e.invoices&&e.invoices.length?t("div",e._l(e.invoices,(function(r){return t(c.a,{key:r._id,staticClass:"mb-3 pa-3",attrs:{elevation:"0",to:"/"+e.customer._id+"/faturas?fatura="+r._id}},[t("div",[t("h4",{staticClass:"mb-1"},[e._v(e._s(r.title))]),e._v(" "),r.points>0?t("div",[t("div",{staticClass:"mb-1"},[r.paidAt?t("div",{staticClass:"caption"},[e._v("\n                    "+e._s(e.$moment(r.paidAt).format("DD/MM/YYYY"))+" -\n                    \n                  ")]):t("div",[t("small",[e._v("\n                      "+e._s(e.$moment(r.createdAt).format("DD/MM/YYYY"))+"\n                    ")])])]),e._v(" "),t("div",[t("EstimateValues",{attrs:{item:f(f({},r),{},{billable:!0})}})],1)]):e._e(),e._v(" "),t("div",{staticClass:"pt-3"},[t("div",["paid"===r.status?t(o.a,{attrs:{outlined:"",small:"",color:"success"}},[t(d.a,{attrs:{left:"",small:""}},[e._v(" mdi-check ")]),e._v("\n                    Paga\n                  ")],1):e._e(),e._v(" "),"rejected"===r.status?t(o.a,{attrs:{outlined:"",small:"",color:"error"}},[t(d.a,{attrs:{left:"",small:""}},[e._v(" mdi-close-thick ")]),e._v("\n                    Recusada\n                  ")],1):e._e(),e._v(" "),"canceled"===r.status?t(o.a,{attrs:{outlined:"",small:"",color:"error"}},[t(d.a,{attrs:{left:"",small:""}},[e._v(" mdi-cancel ")]),e._v("\n                    Cancelada\n                  ")],1):e._e(),e._v(" "),"pending"===r.status&&r.payment_proof?t(o.a,{staticClass:"mb-3",attrs:{small:"",outlined:"",color:"success"}},[t(d.a,{attrs:{left:"",small:""}},[e._v(" mdi-ticket ")]),e._v("\n                    Comprovante enviado!\n                  ")],1):e._e(),e._v(" "),"pending"===r.status?t(o.a,{attrs:{small:"",outlined:""}},[t(d.a,{attrs:{left:"",small:""}},[e._v(" mdi-cash-clock ")]),e._v("\n                    "+e._s(r.payment_proof?"Aguardando confirmação do pagamento":"Aguardando pagamento")+"\n                  ")],1):e._e()],1),e._v(" "),t("div")])])])})),1):e._e()]):t("Loading")],1)]),e._v(" "),e.addInvoice?t("InvoiceForm",{on:{input:e.invoiceCreated,close:function(t){e.addInvoice=!1}}}):e._e(),e._v(" "),e.activeInvoice?t("Invoice",{attrs:{"invoice-id":e.activeInvoice._id},on:{input:e.invoiceUpdated,close:e.closeInvoice}}):e._e()],1)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{Alert:r(602).default,EstimateValues:r(608).default,Loading:r(601).default,InvoiceForm:r(670).default,Invoice:r(688).default})}}]);