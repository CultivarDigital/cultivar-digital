(window.webpackJsonp=window.webpackJsonp||[]).push([[15,8,16],{601:function(e,r,t){"use strict";t.r(r);var n=t(241),c=t(31),component=Object(c.a)({},(function(){var e=this._self._c;return e("div",{staticClass:"text-center"},[e(n.a,{attrs:{indeterminate:""}})],1)}),[],!1,null,null,null);r.default=component.exports},602:function(e,r,t){"use strict";t.r(r);var n=t(591),c={props:{color:{type:String,default:null},message:{type:String,default:null}}},o=t(31),component=Object(o.a)(c,(function(){var e=this,r=e._self._c;return r("div",{staticClass:"text-center",on:{click:function(r){return e.$emit("click")}}},[r(n.a,{attrs:{color:e.color}},[e._v(e._s(e.message))])],1)}),[],!1,null,null,null);r.default=component.exports},626:function(e,r,t){"use strict";t.r(r);var n=t(572),c=t(597),o=t(596),l=t(589),d=t(590),v=(t(26),t(7),t(57),t(1)),f=(t(4),t(11),t(8),t(10),t(13),t(14),t(107));function m(object,e){var r=Object.keys(object);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(object);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),r.push.apply(r,t)}return r}function _(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(r){Object(v.a)(e,r,source[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(source,r))}))}return e}var h={components:{ValidationObserver:f.a,ValidationProvider:f.b},props:{recurringService:{type:Object,default:function(){return null}}},data:function(){return{dialog:!1,form:{name:"",description:null,price:null}}},created:function(){var e=this;this.recurringService&&Object.keys(this.form).forEach((function(r){void 0!==e.recurringService[r]&&null!==e.recurringService[r]&&(e.form[r]=e.recurringService[r])}))},methods:{save:function(){var e=this,form=_({},this.form);this.recurringService?this.$axios.$patch("/v1/recurring-services/"+this.recurringService._id,form).then((function(r){e.$notifier.success("Atualizado!"),e.$emit("input",r)})):this.$axios.$post("/v1/recurring-services",_(_({},form),{},{customer:this.customer._id})).then((function(r){e.$notifier.success("Salvo!"),e.$emit("input",r)}))},close:function(){this.$emit("close")},remove:function(e){this.$emit("remove",e)}}},S=t(31),component=Object(S.a)(h,(function(){var e=this,r=e._self._c;return r(o.a,{attrs:{value:!0,fullscreen:"",persistent:""}},[r(n.a,[r("DialogHeader",{on:{close:e.close}}),e._v(" "),r(c.a,{staticClass:"pt-6"},[r("ValidationObserver",{scopedSlots:e._u([{key:"default",fn:function(t){var n=t.validate,c=t.invalid;return[r(l.a,{on:{submit:function(r){r.preventDefault(),n().then(e.save)}}},[r("div",[r("validation-provider",{attrs:{name:"Nome do serviço",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.errors;return[r(d.a,{attrs:{rows:"1","auto-grow":"",label:"Nome do serviço",outlined:"","error-messages":n,focusable:""},model:{value:e.form.name,callback:function(r){e.$set(e.form,"name",r)},expression:"form.name"}})]}}],null,!0)}),e._v(" "),r("Editor",{attrs:{editable:""},model:{value:e.form.description,callback:function(r){e.$set(e.form,"description",r)},expression:"form.description"}}),e._v(" "),r("validation-provider",{attrs:{name:"Preço",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.errors;return[r("Money",{attrs:{label:"Preço do serviço","error-messages":n},model:{value:e.form.point_price,callback:function(r){e.$set(e.form,"point_price",r)},expression:"form.point_price"}})]}}],null,!0)}),e._v(" "),r("div",{staticClass:"d-flex justify-space-between align-center"},["provider"===e.$auth.user.role&&e.recurringService&&!e.recurringService.paid?r("Remove",{on:{confirm:e.remove}}):e._e(),e._v(" "),r("Save",{attrs:{invalid:c,label:"Salvar serviço recorrente",block:!1}})],1)],1)])]}}])})],1)],1)],1)}),[],!1,null,null,null);r.default=component.exports;installComponents(component,{DialogHeader:t(358).default,Editor:t(604).default,Money:t(364).default,Remove:t(605).default,Save:t(359).default})},641:function(e,r,t){"use strict";t.r(r);var n=t(240),c=t(572),o=t(611),l=t(597),d=t(596),v=t(574),f=t(155),m=(t(26),t(7),t(57),t(22)),_=(t(63),{props:{recurringService:{type:Object,required:!0},preview:{type:Boolean,default:!1}},data:function(){return{edit:!1}},created:function(){},methods:{close:function(){this.$emit("close")},changed:function(e){this.edit=!1,this.$emit("input",e)},remove:function(e){this.$emit("remove",e)},updateStatus:function(e,r){var t=this;return Object(m.a)(regeneratorRuntime.mark((function n(){var c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$axios.$patch("/v1/recurringServices/".concat(e._id),{status:r});case 2:c=n.sent,t.changed(c);case 4:case"end":return n.stop()}}),n)})))()},copy:function(e){var r=this;return Object(m.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.clipboard.writeText(e);case 2:r.notify("Copiado!");case 3:case"end":return t.stop()}}),t)})))()}}}),h=t(31),component=Object(h.a)(_,(function(){var e=this,r=e._self._c;return r(d.a,{attrs:{value:!0,fullscreen:"",persistent:""}},[r(c.a,[r("div",{staticClass:"pb-12"},[r("DialogHeader",{on:{close:e.close}}),e._v(" "),r(l.a,[r("h3",{staticClass:"mb-3"},[e._v(e._s(e.recurringService.name))]),e._v(" "),e.recurringService.description?r("div",{staticClass:"mb-3",domProps:{innerHTML:e._s(e.recurringService.description)}}):e._e(),e._v(" "),e.recurringService.price&&e.recurringService.price>0?r("div",{staticClass:"mb-3"},[r("div",{staticClass:"mb-1"},[r("strong",[e._v("Valor:")]),e._v(" "),r("span",{staticClass:"ml-1"},[e._v("\n              "+e._s(e._f("currency")(e.recurringService.price))+"\n            ")])])]):e._e(),e._v(" "),r("div",{staticClass:"d-flex justify-space-between align-start"},[r("div",[e.recurringService.paid&&"backlog"===e.recurringService.status?r(o.a,{attrs:{outlined:"",small:"",color:"success"}},[r(f.a,{attrs:{left:"",small:""}},[e._v(" mdi-check ")]),e._v(" Paga\n            ")],1):e._e()],1)]),e._v(" "),e.preview||"provider"!==e.$auth.user.role&&e.recurringService.paid?e._e():r("div",{staticClass:"text-right"},[r(v.a,{staticClass:"my-3"}),e._v(" "),r("div",{staticClass:"d-flex justify-space-between align-center"},[r("div",[r(n.a,{on:{click:function(r){e.edit=!0}}},[r(f.a,{attrs:{left:""}},[e._v("mdi-pencil")]),e._v(" Editar\n              ")],1)],1),e._v(" "),e.recurringService.paid?r("div",["backlog"===e.recurringService.status?r(n.a,{attrs:{color:"success",large:""},on:{click:function(r){return e.updateStatus(e.recurringService,"in-progress")}}},[r(f.a,{attrs:{left:""}},[e._v("mdi-play")]),e._v("\n                Iniciar\n              ")],1):e._e(),e._v(" "),"in-progress"===e.recurringService.status?r(n.a,{attrs:{color:"success",large:""},on:{click:function(r){return e.updateStatus(e.recurringService,"done")}}},[r(f.a,{attrs:{left:""}},[e._v("mdi-check")]),e._v("\n                Finalizar\n              ")],1):e._e()],1):e._e()])],1)]),e._v(" "),e.edit?r("RecurringServiceForm",{attrs:{"recurring-service":e.recurringService},on:{input:e.changed,close:function(r){e.edit=!1},remove:e.remove}}):e._e()],1)])],1)}),[],!1,null,null,null);r.default=component.exports;installComponents(component,{DialogHeader:t(358).default,RecurringServiceForm:t(626).default})},670:function(e,r,t){"use strict";t.r(r);var n=t(240),c=t(572),o=t(676),l=t(597),d=t(596),v=t(589),f=t(242),m=t(156),_=t(243),h=t(95),S=t(590),k=(t(26),t(8),t(7),t(13),t(14),t(1)),y=t(22),w=(t(63),t(10),t(4),t(76),t(11),t(85),t(107));function O(object,e){var r=Object.keys(object);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(object);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),r.push.apply(r,t)}return r}function x(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?O(Object(source),!0).forEach((function(r){Object(k.a)(e,r,source[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):O(Object(source)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(source,r))}))}return e}var j={components:{ValidationObserver:w.a,ValidationProvider:w.b},data:function(){return{loading:!1,demands:[],previewDemand:null,previewRecurringService:null,form:{title:this.$moment().locale("pt-br").format("MMM-YYYY").toUpperCase(),status:"pending",price:0,items:[]}}},computed:{demandItems:function(){return this.form.items.filter((function(e){return e.demand}))},recurringServiceItems:function(){return this.form.items.filter((function(e){return e.recurringService}))},totalPrice:function(){return this.selectedItems.reduce((function(e,r){return e+r.price}),0)},selectedItems:function(){return this.form.items.filter((function(e){return e.checked})).map((function(e){return{demand:e.demand?e.demand._id:null,recurringService:e.recurringService?e.recurringService._id:null,price:e.price}}))}},created:function(){this.loadItems()},methods:{loadItems:function(){var e=this;return Object(y.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.loading=!0,r.next=3,e.$axios.$get("/v1/demands",{params:{status:"done",customer:e.customer._id,billable:!0,with_points:!0}});case 3:return e.demands=r.sent,e.demands.forEach((function(r){e.form.items.push({demand:r,price:r.price,checked:!1})})),r.next=7,e.$axios.$get("/v1/recurring-services",{params:{customer:e.customer._id}});case 7:e.recurringServices=r.sent,e.recurringServices.forEach((function(r){e.form.items.push({recurringService:r,price:r.price,checked:!1})})),1===e.form.items.length&&(e.form.items[0].checked=!0),e.loading=!1;case 11:case"end":return r.stop()}}),r)})))()},save:function(){var e=this,form=x({},this.form);form.items=this.selectedItems,form.price=this.totalPrice,this.loading=!0,this.$axios.$post("/v1/invoices",x(x({},form),{},{customer:this.customer._id})).then((function(r){e.$notifier.success("Fatura gerada!"),e.$emit("input",r)})),this.loading=!1},demandUpdated:function(e){var r=this.form.items.find((function(r){return r.demand._id===e._id}));r.demand=e,r.price=e.price,this.previewDemand=e},recurringServiceUpdated:function(e){var r=this.form.items.find((function(r){return r.recurringService._id===e._id}));r.recurringService=e,r.price=e.price,this.previewRecurringService=e},allChecked:function(e){return this.form.items.filter((function(i){return i[e]})).every((function(e){return e.checked}))},toggleSelection:function(e){var r=!0;this.allChecked(e)&&(r=!1),this.form.items.filter((function(i){return i[e]})).forEach((function(e){e.checked=r}))},close:function(){this.$emit("close")}}},C=t(31),component=Object(C.a)(j,(function(){var e=this,r=e._self._c;return r(d.a,{attrs:{value:!0,fullscreen:"",persistent:""}},[r(c.a,[r("DialogHeader",{on:{close:e.close}}),e._v(" "),e.loading?r("div",{staticClass:"pt-6"},[r("Loading")],1):r("div",[r(l.a,[r("h3",{staticClass:"font-weight-medium"},[e._v("Gerar fatura")])]),e._v(" "),r("ValidationObserver",{scopedSlots:e._u([{key:"default",fn:function(t){var c=t.validate,d=t.invalid;return[r(v.a,{on:{submit:function(r){r.preventDefault(),c().then(e.save)}}},[r("div",[r(l.a,[r("validation-provider",{attrs:{name:"Título da fatura",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.errors;return[r(S.a,{attrs:{rows:"1","auto-grow":"",label:"Título da fatura",outlined:"","error-messages":n,focusable:""},model:{value:e.form.title,callback:function(r){e.$set(e.form,"title",r)},expression:"form.title"}})]}}],null,!0)}),e._v(" "),e.demandItems.length?r("div",[r("div",{staticClass:"text-subtitle-2 text--secondary mb-6"},[e._v("\n                  Selecione os items que deseja incluir na fatura:\n                ")]),e._v(" "),e.demandItems.length>1?r("div",{staticClass:"d-flex justify-space-between"},[r("div",[r("strong",[e._v("Demandas")])]),e._v(" "),r(n.a,{attrs:{color:"success","x-small":""},on:{click:function(r){return e.toggleSelection("demand")}}},[e._v("Selecionar\n                    "+e._s(e.allChecked("demand")?"nenhuma":"todas"))])],1):e._e(),e._v(" "),r(f.a,{staticClass:"mx-n4 mb-3"},e._l(e.demandItems,(function(t){return r(m.a,{key:t._id,staticClass:"secondary"},[r(h.a,[r("a",{staticClass:"d-block",on:{click:function(r){e.previewDemand=t.demand}}},[r("span",{staticClass:"text-subtitle-2"},[e._v(e._s(t.demand.title))]),e._v(" "),r("div",{staticClass:"caption text--secondary"},[e._v("\n                          "+e._s(e._f("moeda")(t.price))+"\n                        ")])])]),e._v(" "),r(_.a,[r(o.a,{attrs:{color:"success",large:""},model:{value:t.checked,callback:function(r){e.$set(t,"checked",r)},expression:"item.checked"}})],1)],1)})),1)],1):e._e(),e._v(" "),e.recurringServiceItems.length?r("div",[e.recurringServiceItems.length>1?r("div",{staticClass:"d-flex justify-space-between"},[r("div",[r("strong",[e._v("Serviços recorrentes")])]),e._v(" "),r(n.a,{attrs:{color:"success","x-small":""},on:{click:function(r){return e.toggleSelection("recurringService")}}},[e._v("Selecionar\n                    "+e._s(e.allChecked("recurringService")?"nenhum":"todos"))])],1):e._e(),e._v(" "),r(f.a,{staticClass:"mx-n4 mb-3"},e._l(e.recurringServiceItems,(function(t){return r(m.a,{key:t._id,staticClass:"secondary"},[r(h.a,[r("a",{staticClass:"d-block",on:{click:function(r){e.previewRecurringService=t.recurringService}}},[r("span",{staticClass:"text-subtitle-2"},[e._v(e._s(t.recurringService.name))]),e._v(" "),r("div",{staticClass:"caption text--secondary"},[e._v("\n                          "+e._s(e._f("moeda")(t.price))+"\n                        ")])])]),e._v(" "),r(_.a,[r(o.a,{attrs:{color:"success",large:""},model:{value:t.checked,callback:function(r){e.$set(t,"checked",r)},expression:"item.checked"}})],1)],1)})),1)],1):e._e(),e._v(" "),e.recurringServiceItems.length||e.demandItems.length?e._e():r("div",[r("Alert",{attrs:{message:"Nenhuma demanda ou serviço recorrente foi encontrado para a fatura"}})],1),e._v(" "),e.totalPrice>0?r("div",{staticClass:"text-right"},[r("h3",[e._v("Total: "+e._s(e._f("moeda")(e.totalPrice)))]),e._v(" "),r("Save",{attrs:{invalid:d,block:!1,label:"Salvar"}})],1):e._e()],1)],1)])]}}])})],1),e._v(" "),e.previewDemand?r("Demand",{attrs:{demand:e.previewDemand,preview:""},on:{close:function(r){e.previewDemand=null},input:e.demandUpdated}}):e._e(),e._v(" "),e.previewRecurringService?r("RecurringService",{attrs:{demand:e.previewRecurringService,preview:""},on:{close:function(r){e.previewRecurringService=null},input:e.recurringServiceUpdated}}):e._e()],1)],1)}),[],!1,null,null,null);r.default=component.exports;installComponents(component,{DialogHeader:t(358).default,Loading:t(601).default,Alert:t(602).default,Save:t(359).default,Demand:t(610).default,RecurringService:t(641).default})}}]);