(window.webpackJsonp=window.webpackJsonp||[]).push([[27,17,21,30],{540:function(t,e,n){"use strict";n.r(e);var r=n(220),o=n(538),l=n(194),c={methods:{close:function(){this.$emit("close")}}},d=n(48),component=Object(d.a)(c,(function(){var t=this,e=t._self._c;return e("div",[e(o.a,{staticClass:"d-flex align-center justify-space-between"},[e("div",{staticClass:"d-flex align-center"},[e("img",{staticClass:"logo",attrs:{src:n(235)}}),t._v(" "),e("span",{staticClass:"ml-3"},[e("strong",[t._v("Cultivar")]),t._v(" Digital")])]),t._v(" "),e(r.a,{attrs:{icon:""},on:{click:t.close}},[e(l.a,[t._v("mdi-close")])],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports},542:function(t,e,n){"use strict";n.r(e);var r=n(536),o=n(220),l=n(193),c={props:{invalid:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},block:{type:Boolean,default:!0},label:{type:String,default:"Salvar"}}},d=n(48),component=Object(d.a)(c,(function(){var t=this,e=t._self._c;return e("div",[t.invalid?e(r.a,{staticClass:"d-flex justify-center",attrs:{type:"error"}},[t._v("\n    Você deve corrigir os erros acima antes de salvar\n  ")]):t._e(),t._v(" "),e(o.a,{staticClass:"mb-4 mt-4 font-weight-bold text-none",attrs:{"x-large":"",type:"submit",color:"success",disabled:t.invalid||t.loading,block:t.block,rounded:""}},[t.loading?e(l.a,{attrs:{color:"secondary",indeterminate:"",size:"20"}}):e("span",[t._v(t._s(t.label))])],1)],1)}),[],!1,null,null,null);e.default=component.exports},571:function(t,e,n){"use strict";n.r(e);var r=n(193),o=n(48),component=Object(o.a)({},(function(){var t=this._self._c;return t("div",{staticClass:"text-center"},[t(r.a,{attrs:{indeterminate:""}})],1)}),[],!1,null,null,null);e.default=component.exports},644:function(t,e,n){"use strict";n.r(e);var r=n(572),o=n(642),l=n(538),c=n(703),d=n(582),f=n(221),m=n(143),v=n(222),_=n(151),h=n(592),y=(n(12),n(14),n(18),n(19),n(3)),O=n(17),j=(n(67),n(5),n(77),n(13),n(15),n(192),n(152));function k(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function w(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?k(Object(source),!0).forEach((function(e){Object(y.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):k(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var x={components:{ValidationObserver:j.a,ValidationProvider:j.b},data:function(){return{loading:!1,demands:[],form:{title:this.$moment().locale("pt-br").format("MMM-YYYY").toUpperCase(),status:"pending",points:0,price:0,estimate_in_days:0,items:[]}}},computed:{customer:function(){return this.$store.state.customer},totalPrice:function(){return this.selectedItems.reduce((function(t,e){return t+e.price}),0)},totalPoints:function(){return this.selectedItems.reduce((function(t,e){return t+e.points}),0)},totalEstimateInDays:function(){return this.selectedItems.reduce((function(t,e){return t+e.estimate_in_days}),0)},selectedItems:function(){return this.form.items.filter((function(t){return t.checked})).map((function(t){return{demand:t.demand._id,points:t.points,price:t.price,estimate_in_days:t.estimate_in_days}}))}},created:function(){this.loadDemands()},methods:{loadDemands:function(){var t=this;return Object(O.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.$axios.$get("/v1/demands",{params:{status:"backlog",customer:t.customer._id,approved:!1,billable:!0,with_points:!0}});case 3:t.demands=e.sent,t.demands.forEach((function(e){t.form.items.push({demand:e,price:e.price,points:e.points,estimate_in_days:e.estimate_in_days,checked:!1})})),t.loading=!1;case 6:case"end":return e.stop()}}),e)})))()},save:function(){var t=this,form=w({},this.form);form.items=this.selectedItems,form.price=this.totalPrice,form.points=this.totalPoints,form.estimate_in_days=this.totalEstimateInDays,this.loading=!0,this.$axios.$post("/v1/proposals",w(w({},form),{},{customer:this.customer._id})).then((function(e){t.$notifier.success("Proposta gerada!"),t.$emit("change",e)})),this.loading=!1},toggleMonth:function(t){this.active_month===t?this.active_month=null:this.active_month=t},removeItem:function(t,e,n){this.form.data[t-1][e-1].splice(n,1)},close:function(){this.$emit("close")}}},P=n(48),component=Object(P.a)(x,(function(){var t=this,e=t._self._c;return e(c.a,{attrs:{value:!0,fullscreen:"",persistent:""}},[e(r.a,{staticClass:"template-form"},[e("DialogHeader",{on:{close:t.close}}),t._v(" "),t.loading?e("div",{staticClass:"pt-6"},[e("Loading")],1):e("div",[e(l.a,[e("h3",[t._v("Gerar proposta comercial")])]),t._v(" "),e("ValidationObserver",{scopedSlots:t._u([{key:"default",fn:function(n){var r=n.validate,c=n.invalid;return[e(d.a,{on:{submit:function(e){e.preventDefault(),r().then(t.save)}}},[e("div",[e(l.a,[e("validation-provider",{attrs:{name:"Título da proposta",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(n){var r=n.errors;return[e(h.a,{attrs:{rows:"1","auto-grow":"",label:"Título da proposta",outlined:"","error-messages":r,focusable:""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})]}}],null,!0)}),t._v(" "),e("div",[t._v("Selecione as demandas que deseja incluir na proposta:")])],1),t._v(" "),e(f.a,{attrs:{color:"secondary"}},t._l(t.form.items,(function(n){return e(m.a,{key:n._id},[e(_.a,[e(_.c,[t._v("\n                    "+t._s(n.demand.title)+"\n                  ")]),t._v(" "),n.points>0?e(_.b,[t._v("\n                    "+t._s(t._f("moeda")(n.price))+" ("+t._s(n.estimate_in_days)+"\n                    dias)\n                  ")]):t._e()],1),t._v(" "),e(v.a,[e(o.a,{attrs:{color:"primary"},model:{value:n.checked,callback:function(e){t.$set(n,"checked",e)},expression:"item.checked"}})],1)],1)})),1),t._v(" "),e(l.a,[e("h3",[t._v("\n                Total: "+t._s(t._f("moeda")(t.totalPrice))+" ("+t._s(t.totalEstimateInDays)+"\n                dias)\n              ")]),t._v(" "),t.totalPoints>0?e("div",{staticClass:"text-right"},[e("Save",{attrs:{invalid:c,block:!1,label:"Salvar"}})],1):t._e()])],1)])]}}])})],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{DialogHeader:n(540).default,Loading:n(571).default,Save:n(542).default})}}]);