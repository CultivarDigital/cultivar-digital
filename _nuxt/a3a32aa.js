(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{670:function(t,e,r){"use strict";r.r(e);var o=r(573),n=r(661),l=r(598),c=r(597),d=r(590),m=r(243),f=r(156),v=r(244),_=r(95),h=r(591),y=(r(8),r(7),r(13),r(14),r(1)),O=r(22),P=(r(63),r(4),r(76),r(10),r(11),r(166),r(109));function j(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function w(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(e){Object(y.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var k={components:{ValidationObserver:P.a,ValidationProvider:P.b},data:function(){return{loading:!1,demands:[],form:{title:this.$moment().locale("pt-br").format("MMM-YYYY").toUpperCase(),status:"pending",points:0,price:0,estimate_in_days:0,items:[]}}},computed:{customer:function(){return this.$store.state.customer},totalPrice:function(){return this.selectedItems.reduce((function(t,e){return t+e.price}),0)},totalPoints:function(){return this.selectedItems.reduce((function(t,e){return t+e.points}),0)},totalEstimateInDays:function(){return this.selectedItems.reduce((function(t,e){return t+e.estimate_in_days}),0)},selectedItems:function(){return this.form.items.filter((function(t){return t.checked})).map((function(t){return{demand:t.demand._id,points:t.points,price:t.price,estimate_in_days:t.estimate_in_days}}))}},created:function(){this.loadDemands()},methods:{loadDemands:function(){var t=this;return Object(O.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.$axios.$get("/v1/demands",{params:{status:"backlog",customer:t.customer._id,approved:!1,billable:!0,with_points:!0}});case 3:t.demands=e.sent,t.demands.forEach((function(e){t.form.items.push({demand:e,price:e.price,points:e.points,estimate_in_days:e.estimate_in_days,checked:!1})})),t.loading=!1;case 6:case"end":return e.stop()}}),e)})))()},save:function(){var t=this,form=w({},this.form);form.items=this.selectedItems,form.price=this.totalPrice,form.points=this.totalPoints,form.estimate_in_days=this.totalEstimateInDays,this.loading=!0,this.$axios.$post("/v1/proposals",w(w({},form),{},{customer:this.customer._id})).then((function(e){t.$notifier.success("Proposta gerada!"),t.$emit("input",e)})),this.loading=!1},toggleMonth:function(t){this.active_month===t?this.active_month=null:this.active_month=t},removeItem:function(t,e,r){this.form.data[t-1][e-1].splice(r,1)},close:function(){this.$emit("close")}}},D=r(31),component=Object(D.a)(k,(function(){var t=this,e=t._self._c;return e(c.a,{attrs:{value:!0,fullscreen:"",persistent:""}},[e(o.a,[e("DialogHeader",{on:{close:t.close}}),t._v(" "),t.loading?e("div",{staticClass:"pt-6"},[e("Loading")],1):e("div",[e(l.a,[e("h3",[t._v("Gerar proposta comercial")])]),t._v(" "),e("ValidationObserver",{scopedSlots:t._u([{key:"default",fn:function(r){var o=r.validate,c=r.invalid;return[e(d.a,{on:{submit:function(e){e.preventDefault(),o().then(t.save)}}},[e("div",[e(l.a,[e("validation-provider",{attrs:{name:"Título da proposta",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(r){var o=r.errors;return[e(h.a,{attrs:{rows:"1","auto-grow":"",label:"Título da proposta",outlined:"","error-messages":o,focusable:""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})]}}],null,!0)}),t._v(" "),t.form.items&&t.form.items.length?e("div",[e("div",[t._v("\n                  Selecione as demandas que deseja incluir na proposta:\n                ")]),t._v(" "),e(m.a,{attrs:{color:"secondary"}},t._l(t.form.items,(function(r){return e(f.a,{key:r._id},[e(_.a,[e(_.c,[t._v("\n                        "+t._s(r.demand.title)+"\n                      ")]),t._v(" "),r.points>0?e(_.b,[t._v("\n                        "+t._s(t._f("moeda")(r.price))+" ("+t._s(r.estimate_in_days)+"\n                        dias)\n                      ")]):t._e()],1),t._v(" "),e(v.a,[e(n.a,{attrs:{color:"primary"},model:{value:r.checked,callback:function(e){t.$set(r,"checked",e)},expression:"item.checked"}})],1)],1)})),1),t._v(" "),t.totalPoints>0?e("div",{staticClass:"text-right"},[e("h3",[t._v("\n                    Total: "+t._s(t._f("moeda")(t.totalPrice))+" ("+t._s(t.totalEstimateInDays)+"\n                    dias)\n                  ")]),t._v(" "),e("Save",{attrs:{invalid:c,block:!1,label:"Salvar"}})],1):t._e()],1):e("div",[e("Alert",{attrs:{message:"Nenhuma com valor estimado foi encontrada na fila para a proposta"}})],1)],1)],1)])]}}])})],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{DialogHeader:r(359).default,Loading:r(603).default,Save:r(360).default,Alert:r(602).default})},698:function(t,e,r){"use strict";r.r(e);var o=r(242),n=r(573),l=r(611),c=r(598),d=r(155),m=(r(8),r(7),r(10),r(4),r(13),r(11),r(14),r(1));function f(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function v(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(e){Object(m.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var _=r(22),h=(r(63),r(85),r(216),r(166),{layout:"customer",data:function(){return{proposals:null,addProposal:!1}},computed:{customer:function(){return this.$store.state.customer},activeProposal:function(){var t=this;return this.$route.query.proposta&&this.proposals?this.proposals.find((function(e){return e._id===t.$route.query.proposta})):null}},watch:{customer:function(){this.loadProposals()}},created:function(){var t=this;return Object(_.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.customer){e.next=3;break}return e.next=3,t.loadProposals();case 3:case"end":return e.stop()}}),e)})))()},methods:{loadProposals:function(){var t=this;return Object(_.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.proposals=null,e.next=3,t.$axios.$get("/v1/proposals",{params:{customer:t.customer._id}});case 3:t.proposals=e.sent;case 4:case"end":return e.stop()}}),e)})))()},estimateInDays:function(t){return Math.ceil(t/this.customer.points_per_day)},proposalCreated:function(){this.addProposal=!1,this.loadProposals(),this.loadSummary()},proposalUpdated:function(t){var e=this.proposals.findIndex((function(e){return e._id===t._id}));this.proposals.splice(e,1,t),this.loadSummary()},closeProposal:function(){this.$router.push("/"+this.customer._id+"/propostas")},loadSummary:function(){this.$store.dispatch("loadCustomerSummary")}}}),y=r(31),component=Object(y.a)(h,(function(){var t=this,e=t._self._c;return e("div",["provider"===t.$auth.user.role?e(o.a,{attrs:{fab:"",fixed:"",bottom:"",right:"",color:"success"},on:{click:function(e){t.addProposal=!0}}},[e(d.a,[t._v("mdi-plus")])],1):t._e(),t._v(" "),e(c.a,[e("div",[t.proposals?e("div",[t.proposals.length?t._e():e("div",[e("Alert",{attrs:{message:"Nenhuma proposta aqui"}})],1),t._v(" "),t.proposals&&t.proposals.length?e("div",t._l(t.proposals,(function(r){return e(n.a,{key:r._id,staticClass:"mb-3 pa-3",attrs:{elevation:"0",to:"/"+t.customer._id+"/propostas?proposta="+r._id}},[e("div",[e("h4",{staticClass:"mb-1"},[t._v(t._s(r.title))]),t._v(" "),r.points>0?e("div",[e("div",{staticClass:"mb-1"},[r.startAt&&r.deadline?e("div",{staticClass:"caption"},[t._v("\n                    "+t._s(t.$moment(r.startAt).format("DD/MM/YYYY"))+" -\n                    "+t._s(t.$moment(r.deadline).format("DD/MM/YYYY"))+"\n                  ")]):e("div",[e("small",[t._v("\n                      "+t._s(t.$moment(r.createdAt).format("DD/MM/YYYY"))+"\n                    ")])])]),t._v(" "),e("div",[e("EstimateValues",{attrs:{item:v(v({},r),{},{billable:!0})}})],1)]):t._e(),t._v(" "),e("div",{staticClass:"pt-3"},[e("div",["approved"===r.status?e(l.a,{attrs:{outlined:"",small:"",color:"success"}},[e(d.a,{attrs:{left:"",small:""}},[t._v(" mdi-check ")]),t._v("\n                    Aprovada\n                  ")],1):t._e(),t._v(" "),"rejected"===r.status?e(l.a,{attrs:{outlined:"",small:"",color:"error"}},[e(d.a,{attrs:{left:"",small:""}},[t._v(" mdi-close-thick ")]),t._v("\n                    Rejeitada\n                  ")],1):t._e(),t._v(" "),"canceled"===r.status?e(l.a,{attrs:{outlined:"",small:"",color:"error"}},[e(d.a,{attrs:{left:"",small:""}},[t._v(" mdi-cancel ")]),t._v("\n                    Cancelada\n                  ")],1):t._e(),t._v(" "),"pending"===r.status?e(l.a,{attrs:{small:"",outlined:""}},[e(d.a,{attrs:{left:"",small:""}},[t._v(" mdi-clock ")]),t._v("\n                    Aguardando aprovação\n                  ")],1):t._e()],1),t._v(" "),e("div")])])])})),1):t._e()]):e("Loading")],1)]),t._v(" "),t.addProposal?e("ProposalForm",{on:{input:t.proposalCreated,close:function(e){t.addProposal=!1}}}):t._e(),t._v(" "),t.activeProposal?e("Proposal",{attrs:{"proposal-id":t.activeProposal._id},on:{input:t.proposalUpdated,close:t.closeProposal}}):t._e()],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{Alert:r(602).default,EstimateValues:r(605).default,Loading:r(603).default,ProposalForm:r(670).default,Proposal:r(687).default})}}]);